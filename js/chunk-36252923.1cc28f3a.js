(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-36252923"],{2586:function(e,t,n){"use strict";n.r(t);var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"merge"}},[n("Page",{attrs:{title:e.$t("物料合并"),msgs:"true",showPrinter:"true",showMsg:e.showMsg}},[n("van-cell-group",[n("ScanInput",{ref:"inputReelId",attrs:{label:e.$t("物料条码")},on:{submit:e.onScanInputSubmit}}),n("div",{staticClass:"topDiv"},[e._v(e._s(e.$t("物料编码"))+"："+e._s(e.ReelId))]),n("div",{staticClass:"topDiv"},[e._v(e._s(e.$t("合并后继承第一盘物料信息")))])],1),n("div",[n("el-table",{attrs:{data:e.lvComponents.Items,"highlight-current-row":"",size:"mini"}},[n("el-table-column",{attrs:{align:"center",prop:"ReelId",label:e.$t("物料条码"),"min-width":"30%"}}),n("el-table-column",{attrs:{align:"center",prop:"RemainQty",label:e.$t("数量"),"min-width":"20%"}}),n("el-table-column",{attrs:{align:"center",prop:"Lot",label:e.$t("批次"),"min-width":"28%"}}),n("el-table-column",{attrs:{label:e.$t("操作"),align:"center","min-width":"22%"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(n){return e.handleDelete(t.$index,t.row)}}},[n("van-icon",{attrs:{name:"cross",color:"red"}})],1)]}}])})],1)],1),n("van-button",{staticClass:"BtnButton",staticStyle:{width:"40vw",left:"5vw"},attrs:{type:"info"},on:{click:e.btnRePrint}},[e._v(e._s(e.$t("重打")))]),n("van-button",{staticClass:"BtnButton",staticStyle:{width:"40vw",left:"54vw"},attrs:{type:"info"},on:{click:e.btnMerge}},[e._v(e._s(e.$t("合并")))])],1)],1)},a=[],i=(n("cc16"),n("3cb3"),n("c12e"),n("48d1"),n("ec76"),n("6a61"),n("2e91")),s=n("d211"),u=(n("1b13"),n("f661")),o=(n("4910"),n("b3da")),c=(n("4093"),n("b096")),l=(n("6bfb"),n("bb62")),p=(n("4a1b"),n("2337")),h=(n("69e0"),n("afaf")),f=(n("5545"),n("b5ac")),d=n("a593"),m=n("9973"),b=n("6168"),v=n("9073"),y=n("cf6b"),g=n("caaf"),w=n.n(g),I=n("f648"),R=n("4800");d["default"].use(f["a"]),d["default"].use(h["a"]),d["default"].use(p["a"]),d["default"].use(l["a"]),d["default"].use(c["a"]),d["default"].use(o["a"]),d["default"].use(u["a"]);var O=Object(y["a"])("merge"),P=O.mapState,j={components:{Page:m["a"],ScanInput:b["a"]},data:function(){return{realLot:"",m_listInventory:[],m_listResetInventory:[],lvComponents:{Items:[],Tag:""},m_mergerCount:3,partNumber:"",showMsg:"",num:"",ReelId:this.$t("未扫描"),lastResult:null}},computed:Object(s["a"])(Object(s["a"])({},P(["firstReelId","list","reelIdArr","mates"])),Object(y["e"])(["loading"])),methods:{showMessage:function(e){this.showMsg=e},handleDelete:function(e,t){console.log(e,t),this.lvComponents.Items.splice(e,1),this.m_listInventory.splice(e,1)},onScanInputSubmit:function(e){e=e.trim();var t="";if(-1!=e.indexOf("*")){for(var n=e.split("*"),r=0;r<n.Length;r++)n[r]=n[r].trim();if(n.length<6)return void this.showMessage(this.$t("请扫正确的二维码!"));t=n[5]}else t=e;null!=this.m_listInventory&&R.from(this.m_listInventory).any((function(e){return e.ReelId==t.trim()}))?this.showMessage(this.$t("物料已经扫描，无需重复操作!")):this.reelIdArr.length>=3?this.showMessage(this.$t("每次合并数量不可大于3包")):this.DoCheckScanPart(t)},DoCheckScanPart:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function n(){var r,a;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,v["e"](null,{EReelId:e});case 2:if(r=n.sent,0!=r.length){n.next=6;break}return t.showMessage(e+t.$t("不存在!")),n.abrupt("return");case 6:if(a=r[0],!(a.RemainQty<=0)){n.next=10;break}return t.showMessage(t.$t("物料余量不足!")),n.abrupt("return");case 10:if(!(a.ExpiredDate<w()())){n.next=13;break}return t.showMessage(t.$t("物料已过期!")),n.abrupt("return");case 13:if(!(t.lvComponents.Items.Count>=t.m_mergerCount)){n.next=16;break}return t.showMessage(t.$t("超出最大合并盘数")),n.abrupt("return");case 16:if(a.STATUS!=I["a"].Locked){n.next=19;break}return t.showMessage(t.$t("物料已经锁定!")),n.abrupt("return");case 19:if(a.STATUS!=I["a"].Closed){n.next=22;break}return t.showMessage(t.$t("物料已经关闭!")),n.abrupt("return");case 22:if(a.STATUS!=I["a"].Completed){n.next=25;break}return t.showMessage(t.$t("物料已经耗尽!")),n.abrupt("return");case 25:if(a.STATUS!=I["a"].MRPLocked){n.next=28;break}return t.showMessage(t.$t("物料已经MRP锁定!")),n.abrupt("return");case 28:t.ReelId=a.PartNumber,t.AddListViewItem(!0,a);case 30:case"end":return n.stop()}}),n)})))()},RemoveItem:function(e){this.lvComponents.Items.splice(e,1),this.m_listInventory.splice(e,1)},AddListViewItem:function(e,t){if(e&&null!=this.m_listResetInventory&&this.m_listResetInventory.length>0)this.showMessage(this.$t("合并前先清空历史信息!"));else if(!e&&null!=this.m_listInventory&&this.m_listInventory.length>0)this.showMessage(this.$t("重打前先清空历史信息!"));else if(this.showMessage("ReelID:"+t.ReelId),0==this.lvComponents.Items.length){var n={ReelId:t.ReelId,RemainQty:t.RemainQty,Lot:t.Lot,DateCode:t.DataCode};this.lvComponents.Items.push(n),this.lvComponents.Tag=t.PartNumber,this.partNumber=t.PartNumber,this.realLot=t.Lot,e?this.m_listInventory.push(t):this.m_listResetInventory.push(t)}else{if(t.PartNumber!=this.lvComponents.Tag)return void this.showMessage(this.$t("不是同种物料不能合并!"));var r={ReelId:t.ReelId,RemainQty:t.RemainQty,Lot:t.Lot,DateCode:t.DataCode};this.lvComponents.Items.push(r),this.m_listInventory.push(t)}},GetPrinter:function(){var e=localStorage.getItem("printers"),t=e?JSON.parse(e):[];if(0==t.length)return this.showMessage(this.$t("未配置打印机")),null;for(var n=null,r=0;r<t.length;r++)if(t[r].active){n=t[r];break}return null==n?(this.showMessage(this.$t("未配置默认打印机")),null):n},btnMerge:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var n,r,a,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!(e.lvComponents.Items.length<2)){t.next=3;break}return e.showMessage(e.$t("合并盘数小于2盘!")),t.abrupt("return");case 3:if(n=e.GetPrinter(),null!=n){t.next=6;break}return t.abrupt("return");case 6:return e.$loading(),t.next=9,v["c"](n.ip);case 9:if(r=t.sent,r){t.next=13;break}return e.showMessage(e.$t("默认打印机连接失败")),t.abrupt("return");case 13:if(e.$clrLoading(),e.m_listInventory&&!(e.m_listInventory.length<=0)){t.next=17;break}return e.showMessage(e.$t("请扫描需要合并的物料")),t.abrupt("return");case 17:return e.$loading(),t.next=20,v["m"](R.from(e.m_listInventory).select((function(e){return e.ReelId})).toArray());case 20:if(a=t.sent,e.$clrLoading(),a){e.lastResult=a,i=e.$t("合并完成!"),i+="\r\n Message",i+=" \r\n "+e.$t("Result:Operation success!"),i+=" \r\n New ReelId: "+a.ReelId+", Qty:"+a.RemainQty,e.$refs.inputReelId.clearInput(),e.showMessage(i),e.lvComponents.Items=[],e.m_listInventory=[];try{v["q"](a.Id,n.ip)}catch(s){e.showMessage(s)}e.lvComponents.Items=[],e.RecoveryValue()}case 23:case"end":return t.stop()}}),t)})))()},btnDeleted:function(e){this.m_listInventory=R.from(this.m_listInventory).Where((function(t){return t.ReelId!=e.ReelId})).ToList(),this.m_listResetInventory=R.from(this.m_listResetInventory).Where((function(t){return t.ReelId!=e.ReelId})).ToList(),this.lvComponents=R.from(this.lvComponents).Where((function(t){return t.ReelId!=e.ReelId})).ToList()},RecoveryValue:function(){this.lvComponents.Items.Clear(),this.lvComponents.Tag="",this.m_listResetInventory.Clear(),this.m_listInventory.Clear()},btnRePrint:function(){if(this.lastResult){var e=this.GetPrinter();if(null==e)return;try{v["q"](this.lastResult.Id,e.ip)}catch(t){this.showMessage(t)}}else this.showMessage(this.$t("未找到合并结果"))}}},x=j,M=(n("7bc4"),n("5d22")),k=Object(M["a"])(x,r,a,!1,null,null,null);t["default"]=k.exports},5545:function(e,t,n){"use strict";n("2fc3")},"5a75":function(e,t,n){},"7bc4":function(e,t,n){"use strict";n("5a75")},9073:function(e,t,n){"use strict";n.d(t,"e",(function(){return s})),n.d(t,"p",(function(){return o})),n.d(t,"m",(function(){return l})),n.d(t,"l",(function(){return h})),n.d(t,"o",(function(){return d})),n.d(t,"n",(function(){return b})),n.d(t,"g",(function(){return y})),n.d(t,"a",(function(){return w})),n.d(t,"b",(function(){return R})),n.d(t,"s",(function(){return P})),n.d(t,"i",(function(){return x})),n.d(t,"k",(function(){return k})),n.d(t,"j",(function(){return C})),n.d(t,"h",(function(){return $})),n.d(t,"d",(function(){return T})),n.d(t,"t",(function(){return B})),n.d(t,"f",(function(){return D})),n.d(t,"q",(function(){return Q})),n.d(t,"c",(function(){return V})),n.d(t,"r",(function(){return U}));n("6a61");var r=n("2e91"),a=n("b775"),i=n("3753");function s(e,t){return u.apply(this,arguments)}function u(){return u=Object(r["a"])(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(a["a"])(Object(i["a"])("ML/PartInventoryApi/GetInventorys",t),{method:"POST",body:n});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),u.apply(this,arguments)}function o(e,t){return c.apply(this,arguments)}function c(){return c=Object(r["a"])(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(a["a"])(Object(i["a"])("ML/PartInventoryApi/PartPartition",t),{method:"POST",body:n});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),c.apply(this,arguments)}function l(e){return p.apply(this,arguments)}function p(){return p=Object(r["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(a["a"])(Object(i["a"])("ML/PartInventoryApi/PartMerger",null),{method:"POST",body:t});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),p.apply(this,arguments)}function h(e,t){return f.apply(this,arguments)}function f(){return f=Object(r["a"])(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(a["a"])(Object(i["a"])("ML/PartInventoryApi/PartIn",t),{method:"POST",body:n});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),f.apply(this,arguments)}function d(e,t){return m.apply(this,arguments)}function m(){return m=Object(r["a"])(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(a["a"])(Object(i["a"])("ML/PartInventoryApi/PartOut",t),{method:"POST",body:n});case 2:return r=e.sent,e.abrupt("return",r);case 4:case"end":return e.stop()}}),e)}))),m.apply(this,arguments)}function b(e,t){return v.apply(this,arguments)}function v(){return v=Object(r["a"])(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(a["a"])(Object(i["a"])("ML/PartInventoryApi/PartMove",t),{method:"POST",body:n});case 2:return r=e.sent,e.abrupt("return",r);case 4:case"end":return e.stop()}}),e)}))),v.apply(this,arguments)}function y(e,t){return g.apply(this,arguments)}function g(){return g=Object(r["a"])(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(a["a"])(Object(i["a"])("/ML/CheckInventoryApi/GetAll",t),{method:"POST",body:n});case 2:return r=e.sent,e.abrupt("return",r);case 4:case"end":return e.stop()}}),e)}))),g.apply(this,arguments)}function w(e){return I.apply(this,arguments)}function I(){return I=Object(r["a"])(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(a["a"])(Object(i["a"])("ML/CheckInventoryTempContentApi/GetAll",null),{method:"POST",body:t});case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e)}))),I.apply(this,arguments)}function R(e,t){return O.apply(this,arguments)}function O(){return O=Object(r["a"])(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(a["a"])(Object(i["a"])("ML/CheckInventoryTempContentApi/Submit",{strId:t}),{method:"POST",body:n});case 2:return r=e.sent,e.abrupt("return",r);case 4:case"end":return e.stop()}}),e)}))),O.apply(this,arguments)}function P(e,t,n){return j.apply(this,arguments)}function j(){return j=Object(r["a"])(regeneratorRuntime.mark((function e(t,n,r){var s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(a["a"])(Object(i["a"])("ML/CheckInventoryApi/SubmitCheckInventoryData",{checkInventoryId:t,reelId:n,remainQty:r}),{method:"POST",body:{}});case 2:return s=e.sent,e.abrupt("return",s);case 4:case"end":return e.stop()}}),e)}))),j.apply(this,arguments)}function x(e,t){return M.apply(this,arguments)}function M(){return M=Object(r["a"])(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(a["a"])(Object(i["a"])("ML/PartInventoryApi/ChangeInventoryQty",{reelId:t,RemainQty:n}),{method:"POST",body:{}});case 2:return r=e.sent,e.abrupt("return",r);case 4:case"end":return e.stop()}}),e)}))),M.apply(this,arguments)}function k(e){return S.apply(this,arguments)}function S(){return S=Object(r["a"])(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(a["a"])(Object(i["a"])("ML/PartApi/GridPageListJson",null),{method:"POST",body:t});case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e)}))),S.apply(this,arguments)}function C(e){return L.apply(this,arguments)}function L(){return L=Object(r["a"])(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(a["a"])(Object(i["a"])("ML/PartInventoryApi/GetInventorys",null),{method:"POST",body:t});case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e)}))),L.apply(this,arguments)}function $(e,t,n){return A.apply(this,arguments)}function A(){return A=Object(r["a"])(regeneratorRuntime.mark((function e(t,n,r){var s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(a["a"])(Object(i["a"])("ML/PartInventoryApi/ICPartBindLot",{reelId:t,lot:n,isRewrite:r}),{method:"POST",body:{}});case 2:return s=e.sent,e.abrupt("return",s);case 4:case"end":return e.stop()}}),e)}))),A.apply(this,arguments)}function T(e,t){return _.apply(this,arguments)}function _(){return _=Object(r["a"])(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(a["a"])(Object(i["a"])("ML/PartInventoryApi/GetInventoryWithAutoRegistory",t),{method:"POST",body:n});case 2:return r=e.sent,e.abrupt("return",r);case 4:case"end":return e.stop()}}),e)}))),_.apply(this,arguments)}function B(e,t){return F.apply(this,arguments)}function F(){return F=Object(r["a"])(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(a["a"])(Object(i["a"])("ML/PartInventoryApi/PartAutoRecommenStorage",t),{method:"POST",body:n});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),F.apply(this,arguments)}function D(e,t){return N.apply(this,arguments)}function N(){return N=Object(r["a"])(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(a["a"])(Object(i["a"])("/ML/LifecycleApi/GetAll",t),{method:"POST",body:n});case 2:return r=e.sent,e.abrupt("return",r);case 4:case"end":return e.stop()}}),e)}))),N.apply(this,arguments)}function Q(e,t){return G.apply(this,arguments)}function G(){return G=Object(r["a"])(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(a["a"])(Object(i["a"])("/ML/PartInventoryApi/PrintInventoryLabel",{inventoryId:t,printerIp:n}),{method:"POST",body:{}});case 2:return r=e.sent,e.abrupt("return",r);case 4:case"end":return e.stop()}}),e)}))),G.apply(this,arguments)}function V(e){return E.apply(this,arguments)}function E(){return E=Object(r["a"])(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(a["a"])(Object(i["a"])("/ML/PartInventoryApi/CheckPrintConnection",{printerIp:t}),{method:"POST",body:{}});case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e)}))),E.apply(this,arguments)}function U(e,t){return W.apply(this,arguments)}function W(){return W=Object(r["a"])(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(a["a"])(Object(i["a"])("ML/PartInventoryApi/SearchInventorieCompleteds",t),{method:"POST",body:n});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),W.apply(this,arguments)}},b5ac:function(e,t,n){"use strict";var r=n("e28f"),a=n("9379"),i=Object(r["a"])("form"),s=i[0],u=i[1];t["a"]=s({props:{colon:Boolean,disabled:Boolean,readonly:Boolean,labelWidth:[Number,String],labelAlign:String,inputAlign:String,scrollToError:Boolean,validateFirst:Boolean,errorMessageAlign:String,submitOnEnter:{type:Boolean,default:!0},validateTrigger:{type:String,default:"onBlur"},showError:{type:Boolean,default:!0},showErrorMessage:{type:Boolean,default:!0}},provide:function(){return{vanForm:this}},data:function(){return{fields:[]}},methods:{getFieldsByNames:function(e){return e?this.fields.filter((function(t){return-1!==e.indexOf(t.name)})):this.fields},validateSeq:function(e){var t=this;return new Promise((function(n,r){var a=[],i=t.getFieldsByNames(e);i.reduce((function(e,t){return e.then((function(){if(!a.length)return t.validate().then((function(e){e&&a.push(e)}))}))}),Promise.resolve()).then((function(){a.length?r(a):n()}))}))},validateFields:function(e){var t=this;return new Promise((function(n,r){var a=t.getFieldsByNames(e);Promise.all(a.map((function(e){return e.validate()}))).then((function(e){e=e.filter((function(e){return e})),e.length?r(e):n()}))}))},validate:function(e){return e&&!Array.isArray(e)?this.validateField(e):this.validateFirst?this.validateSeq(e):this.validateFields(e)},validateField:function(e){var t=this.fields.filter((function(t){return t.name===e}));return t.length?new Promise((function(e,n){t[0].validate().then((function(t){t?n(t):e()}))})):Promise.reject()},resetValidation:function(e){e&&!Array.isArray(e)&&(e=[e]);var t=this.getFieldsByNames(e);t.forEach((function(e){e.resetValidation()}))},scrollToField:function(e,t){this.fields.some((function(n){return n.name===e&&(n.$el.scrollIntoView(t),!0)}))},addField:function(e){this.fields.push(e),Object(a["a"])(this.fields,this)},removeField:function(e){this.fields=this.fields.filter((function(t){return t!==e}))},getValues:function(){return this.fields.reduce((function(e,t){return e[t.name]=t.formValue,e}),{})},onSubmit:function(e){e.preventDefault(),this.submit()},submit:function(){var e=this,t=this.getValues();this.validate().then((function(){e.$emit("submit",t)})).catch((function(n){e.$emit("failed",{values:t,errors:n}),e.scrollToError&&e.scrollToField(n[0].name)}))}},render:function(){var e=arguments[0];return e("form",{class:u(),on:{submit:this.onSubmit}},[this.slots()])}})},f648:function(e,t,n){"use strict";n.d(t,"c",(function(){return r})),n.d(t,"a",(function(){return a})),n.d(t,"b",(function(){return i}));var r={Pending:10,Pass:20,Failed:30,Reverify_Pass:4,Reverify_Failed:5},a={Locked:1,Closed:2,Completed:3,Initialized:4,MRPLocked:5,Prepared:6,QALocked:7,Ready:8,InProcess:9},i={WatingUse:1,Using:2,Bad:3}}}]);