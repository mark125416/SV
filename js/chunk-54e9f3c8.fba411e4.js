(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-54e9f3c8"],{"0257":function(t,e,n){"use strict";n("38e6")},"02c4":function(t,e,n){"use strict";n("b5df")},3073:function(t,e,n){},"38e6":function(t,e,n){},"415b":function(t,e,n){"use strict";n.r(e);var r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"split"}},[n("Page",{attrs:{title:t.$t("逐站检验"),msgs:"false"}},[n("ScanInput",{directives:[{name:"show",rawName:"v-show",value:t.isShowScan,expression:"isShowScan"}],attrs:{label:t.$t("扫描条码")},on:{submit:t.m_scanner_OnScannerReaded}}),n("div",{ref:"con1",staticClass:"dic1"},[n("van-sticky",{attrs:{container:t.con1,"offset-top":46}},[n("div",{ref:"topDiv",staticClass:"topDiv"},[t._v(" "+t._s(t.$t("程序名"))+"："+t._s(t.program)+" "),n("br"),t._v(" "+t._s(t.$t("区域"))+":"+t._s(t.area)+" ")])]),n("van-tabs",{staticClass:"TabHeight",attrs:{color:"#4284f4"},model:{value:t.activeTab,callback:function(e){t.activeTab=e},expression:"activeTab"}},[n("van-tab",{attrs:{title:t.$t("操作")}},[n("MessageBox",{ref:"messageBox",staticClass:"lonelyMeg"}),n("InputCell",{attrs:{title:t.$t("物料条码"),value:t.txtCmp.Text},on:{"update:value":function(e){return t.$set(t.txtCmp,"Text",e)}}}),n("InputCell",{attrs:{title:t.$t("站位号"),value:t.displayLocation,type:"text"},on:{"update:value":function(e){t.displayLocation=e}}}),n("div",{staticClass:"checkstate"},[t._v(" "+t._s(t.$t("检验状态"))+" "),n("div",[n("div",{staticClass:"green"},[t._v(t._s(t.$t("成功"))+":"+t._s(t.PassQty))]),n("div",{staticClass:"red"},[t._v(t._s(t.$t("失败"))+":"+t._s(t.NGQty))]),n("div",{staticClass:"orange"},[t._v(t._s(t.$t("未检验"))+":"+t._s(t.WaitingQty))])])]),"AX501"==t.equipmentName?n("van-button",{staticStyle:{margin:"10px 15px",width:"calc(100% - 30px )"},attrs:{type:"info"},on:{click:t.isTopFirstC}},[t._v(t._s(t.$t("上排优先")))]):t._e(),n("van-button",{staticClass:"BtnButton",staticStyle:{width:"calc(94vw - 30px)",left:"calc(3vw + 15px)"},attrs:{type:"info",loading:!t.btnVerify_Enabled},on:{click:t.btnVerify_Click}},[t._v(t._s(t.$t("检验")))])],1),n("van-tab",{attrs:{title:t.$t("记录")}},[n("el-table",{attrs:{data:t.m_onlineSetupList,"highlight-current-row":"",size:"mini","row-class-name":t.tableRowClassName,height:t.tableH}},[n("el-table-column",{attrs:{prop:"PARTNUMBER",label:t.$t("物料编号"),"min-width":"43%"}}),n("el-table-column",{attrs:{prop:"DisplayLocation",label:t.$t("站位"),"min-width":"27%"}}),n("el-table-column",{attrs:{prop:"VerificationResult",label:t.$t("状态"),"min-width":"30%"}})],1)],1)],1)],1)],1)],1)},i=[],s=(n("a5bc"),n("b6b5"),n("31d6"),n("247c"),n("6a61"),n("9ad1")),a=(n("5c26"),n("12f5")),o=(n("fe7f"),n("2b22")),c=(n("06bb"),n("28e4")),u=n("a593"),l=n("9973"),p=n("6168"),f=n("b7bd"),m=n("521f"),h=n("5c5a"),d=n("1c01"),x=n("f648"),g=n("6255"),v=n("cf45"),_=n("31d9"),b=n("4800");u["default"].use(g["Table"]),u["default"].use(c["a"]),u["default"].use(o["a"]),u["default"].use(a["a"]);var S={components:{Page:l["a"],ScanInput:p["a"],MessageBox:m["a"],InputCell:f["a"]},data:function(){return{barcode:"",tableH:"0",m_onlineSetupList:[],m_currentSetupItem:null,m_division:1,CurrentLocationIndex:"",isTopFirst:"ascending",VerifyData:{},txtCmp:{Text:""},txtTrack:{Text:""},btnVerify_Enabled:!0,setupLists:[],btnUpper:{tag:1,txt:this.$t("上"),visible:!0},nowDiv:1,area:"",program:"",activeTab:0,code:"",num:"",con1:null,Qty:0,PartNumber:"",PassQty:0,NGQty:0,WaitingQty:0,isShowScan:!1,currentStation:null,equipmentName:"",displayLocation:""}},mounted:function(){this.tableH=window.screen.height-this.$refs.topDiv.offsetHeight-30-46,this.con1=this.$refs.con1;var t=JSON.parse(window.localStorage.getItem("currentLine")),e=JSON.parse(window.localStorage.getItem("currentUser"));try{this.$nextTick((function(){this.CurrentLocationIndex=this.$store.getters["svSession/getCurrentLocationIndex"],this.currentStation=this.$store.getters["svSession/getCurrentStation"],this.equipmentName=this.currentStation.STATION_NAME,this.area=t.LINE_NAME+", "+this.equipmentName+" , L"+this.CurrentLocationIndex,window._currentMessageBox=this.$refs.messageBox;var n=this;this.VerifyData.VerificationMode="OnlineVerifyTrackCheck",this.VerifyData.LineName=t.LINE_NAME,this.VerifyData.StationName=this.equipmentName,this.VerifyData.Operator=e.STAFF_NUMBER,this.$nextTick((function(){n.LoadSetupData()})),setTimeout((function(){window._currentMessageBox=n.$refs.messageBox}),500)}))}catch(n){this.$nextTick((function(){this.showMessage("EventsCenter_OnFormReady():"+n)}))}},methods:{showMessage:function(t){this.$refs.messageBox.showMessage(t)},tableRowClassName:function(t){return t=t.row,t.VERIFICATION_RESULT==x["c"].Pass?"green":t.VERIFICATION_RESULT==x["c"].Failed?"red":void 0},nextBtn:function(){this.nowDiv=1},m_scanner_OnScannerReaded:function(t){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function n(){var r,i,s,a,o,c,u,l,p,f,m;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(t){n.next=2;break}return n.abrupt("return");case 2:if(n.prev=2,null!=e.m_onlineSetupList||0!=e.m_onlineSetupList.length){n.next=5;break}return n.abrupt("return");case 5:if(r=/POS(.*)\$(\d)/i,i=r.test(t),s=/^E\d{4}/,a=s.test(t),!i){n.next=24;break}if(e.btnUpper.Visible&&(e.btnUpper.Visible=!1),e.m_currentSetupItem=b.from(e.m_onlineSetupList).firstOrDefault((function(e){return-1!=e.PosTexts.indexOf(t)})),null!=e.m_currentSetupItem){n.next=14;break}return n.abrupt("return");case 14:console.log(e.m_currentSetupItem),o=e.m_currentSetupItem.Location,c=e.m_currentSetupItem.DisplayLocation,e.showMessage(e.$t("扫描到上料位：{0}",[c])),e.txtTrack.Text=o,console.log(e.txtTrack.Text),e.displayLocation=c,e.VerifyData.OnlineSetupList=e.m_currentSetupItem,n.next=59;break;case 24:if(!a){n.next=44;break}if(e.btnUpper.visible||(e.btnUpper.visible=!0),u=e.btnUpper.tag,e.m_currentSetupItem=b.from(e.m_onlineSetupList).firstOrDefault((function(e){return-1!=e.PosTexts.indexOf(t)})),null!=e.m_currentSetupItem){n.next=36;break}if(l=1==u?2:1,e.m_currentSetupItem=b.from(e.m_onlineSetupList).firstOrDefault((function(e){return-1!=e.PosTexts.indexOf(t)})),null!=e.m_currentSetupItem){n.next=33;break}return n.abrupt("return");case 33:p=e.m_currentSetupItem.Location,e.showMessage(1==l?e.$t("发现上侧有物料，自动切换到{0}",[p]):e.$t("发现下侧有物料，自动切换到{0}",[p])),e.btnUpper_Click();case 36:f=e.m_currentSetupItem.Location,m=e.m_currentSetupItem.DisplayLocation,e.showMessage(e.$t("扫描到上料位：{0}",[m])),e.txtTrack.Text=f,e.displayLocation=m,e.VerifyData.OnlineSetupList=e.m_currentSetupItem,n.next=59;break;case 44:if(e.VerifyData.PartBarcode=t,console.log("条码内容:"+e.VerifyData.PartBarcode),-1==t.indexOf("/")){n.next=54;break}if(t=Object(h["e"])(t),console.log("条码内容:"+t),!(null==t||t.trim().length<=0)){n.next=52;break}return e.showMessage(e.$t("条码格式不正确")),n.abrupt("return");case 52:n.next=56;break;case 54:return e.showMessage(e.$t("条码格式不正确")),n.abrupt("return");case 56:e.showMessage(e.$t("扫描到物料：{0}",[t])),e.txtCmp.Text=t,e.VerifyData.ComponentBarcode=t;case 59:console.log(e.Text+"--"+e.txtCmp.Text),e.txtTrack.Text&&e.txtTrack.Text.trim().length>=0&&""!=e.txtCmp.Text&&e.txtCmp.Text.trim().length>=0&&e.Verify(),n.next=66;break;case 63:n.prev=63,n.t0=n["catch"](2),e.showMessage("m_scanner_OnScannerReaded():".concat(n.t0));case 66:case"end":return n.stop()}}),n,null,[[2,63]])})))()},Verify:function(){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function e(){var n,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.showMessage(t.$t("开始验证...")),t.btnVerify_Enabled=!1,e.prev=2,t.VerifyData.ComponentBarcode=t.txtCmp.Text.trim(),e.next=6,d["s"](t.VerifyData);case 6:n=e.sent,t.txtCmp.Text="",n&&(t.m_currentSetupItem.VERIFICATION_RESULT=n.VERIFICATION_RESULT,t.m_currentSetupItem.VerificationResult=n.VerificationResult,t.computeQty()),n&&n.Result?(Object(v["d"])(),r=b.from(t.m_onlineSetupList).count((function(t){return t.VERIFICATION_RESULT!=x["c"].Pass})),t.showMessage(t.$t("验证成功...")),t.showMessage(t.$t("待验料数量:{0}",[r])),t.txtTrack.Text="",t.displayLocation="",t.txtCmp.Text=""):(Object(v["c"])(),t.showMessage(t.$t("验料失败"))),e.next=16;break;case 12:e.prev=12,e.t0=e["catch"](2),console.log(e.t0),t.showMessage(t.$t("请求超时,请重新操作"));case 16:return e.prev=16,t.btnVerify_Enabled=!0,e.finish(16);case 19:case"end":return e.stop()}}),e,null,[[2,12,16,19]])})))()},isTopFirstC:function(){if(this.isTopFirst="ascending",console.log(this.isTopFirst),null!=this.txtTrack.Text&&""!=this.txtTrack.Text){var t=parseInt(this.txtTrack.Text.split("-")[2]);console.log(t);var e=1==t?2:1,n=this.txtTrack.Text.substring(0,this.Text.length-1)+e;if(console.log(n),this.m_currentSetupItem=b.from(this.m_onlineSetupList).firstOrDefault((function(t){return t.Location==n})),null!=this.m_currentSetupItem){var r=this.m_currentSetupItem.Location,i=this.m_currentSetupItem.DisplayLocation;this.showMessage(this.$t("扫描到上料位：{0}",[i])),this.txtTrack.Text=r,this.displayLocation=i,this.VerifyData.OnlineSetupList=this.m_currentSetupItem}}},btnVerify_Click:function(){this.txtTrack.Text.size.trim().length>=0&&null!=this.txtTrack.Text.size&&this.txtCmp.Text.trim().length>=0&&null!=this.txtCmp.Text&&this.Verify()},btnUpper_Click:function(){try{if(1!=parseInt(this.btnUpper.tag)?(this.m_division=1,this.btnUpper.tag=1,this.btnUpper.txt=this.$t("上")):(this.m_division=2,this.btnUpper.tag=2,this.btnUpper.txt=this.$t("下")),null!=this.txtTrack.Text&&this.txtTrack.Text.trim().length>=0&&null!=this.m_currentSetupItem){var t=this.m_currentSetupItem.Location.split("-"),e=Object(h["a"])(this.equipmentName,this.CurrentLocationIndex,t[1],this.m_division);if(this.m_currentSetupItem=b.from(this.m_onlineSetupList).firstOrDefault((function(t){return t.Location==e})),null==this.m_currentSetupItem)return this.txtTrack.Text="",void(this.VerifyData.OnlineSetupList={});this.showMessage(this.$t("上料位：{0}",[this.m_currentSetupItem.DisplayLocation])),this.txtTrack.Text=this.m_currentSetupItem.Location,this.displayLocation=this.m_currentSetupItem.DisplayLocation,this.VerifyData.OnlineSetupList=this.m_currentSetupItem}}catch(n){this.showMessage("btnUpper_Click():"+n)}},computeQty:function(){var t=b.from(this.m_onlineSetupList).count(),e=b.from(this.m_onlineSetupList).count((function(t){return t.VERIFICATION_RESULT==x["c"].Pass||t.VERIFICATION_RESULT==x["c"].Reverify_Pass}));this.PassQty=e;var n=b.from(this.m_onlineSetupList).count((function(t){return t.VERIFICATION_RESULT==x["c"].Failed||t.VERIFICATION_RESULT==x["c"].Reverify_Failed}));this.NGQty=n,this.WaitingQty=t-this.PassQty-this.NGQty},LoadSetupData:function(){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function e(){var n,r,i,s,a,o,c;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.m_onlineSetupList=[],t.setupLists=[],e.prev=2,t.$loading(),e.next=6,d["p"]({stationId:t.currentStation.Id,locationIndex:t.CurrentLocationIndex,isTopFirst:!1});case 6:if(n=e.sent,n||!(null==n.lstOnlineSetupList||n.lstOnlineSetupList.length<=0)){e.next=10;break}return t.showMessage(t.$t("无上料表")),e.abrupt("return");case 10:for(r=n.lstOnlineSetupList,t.program=n.recipeName,t.VerifyData.RecipeName=n.recipeName,i=0;i<r.length;i++)r[i].orderTexts=r[i].Location.split("-"),r[i].PosTexts=Object(h["b"])(r[i].Location,t.equipmentName),console.log(r[i].Location+"    "),console.log(r[i].PosTexts);for(s=b.from(r).where((function(t){return!_(t.Location).endsWith("T")})).orderBy((function(t){return t.orderTexts[0]})).thenBy((function(t){return _(t.orderTexts[1]).padLeft(2,"0").s})).thenBy((function(t){return _(t.orderTexts[2]).padLeft(3,"0").s})).toArray(),a=b.from(r).where((function(t){return _(t.Location).endsWith("T")})).orderBy((function(t){return t.orderTexts[0]})).thenBy((function(t){return _(t.orderTexts[1]).padLeft(2,"0").s})).thenBy((function(t){return _(t.orderTexts[2]).padLeft(3,"0").s})).toArray(),o=0;o<a.length;o++)s.push(a[o]);t.m_onlineSetupList=s,console.log(t.m_onlineSetupList),t.computeQty(),e.next=25;break;case 22:e.prev=22,e.t0=e["catch"](2),t.showMessage("LoadSetupData():"+e.t0);case 25:return e.prev=25,t.$clrLoading(),e.finish(25);case 28:c=b.from(t.m_onlineSetupList).count((function(t){return t.VERIFICATION_RESULT!=x["c"].Pass})),t.showMessage(t.$t("待验料数量:{0}",[c]));case 30:case"end":return e.stop()}}),e,null,[[2,22,25,28]])})))()}}},T=S,I=(n("02c4"),n("0257"),n("5d22")),L=Object(I["a"])(T,r,i,!1,null,null,null);e["default"]=L.exports},"521f":function(t,e,n){"use strict";var r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("textarea",{directives:[{name:"model",rawName:"v-model",value:t.messages,expression:"messages"}],ref:"messageBox",staticClass:"lonelyMeg",attrs:{rows:"11",readonly:""},domProps:{value:t.messages},on:{input:function(e){e.target.composing||(t.messages=e.target.value)}}})},i=[],s=(n("82a8"),{props:{showMsg:{type:String,require:!1,default:""}},data:function(){return{messages:"",count:0}},methods:{showMessage:function(t){if(null!=t&&""!=t&&void 0!=t){this.count>=50?(this.messages=" "+t+"\r\n",this.count=1):this.messages+=" "+t+"\r\n";var e=this;setTimeout((function(){e.$refs.messageBox.scrollTop=e.$refs.messageBox.scrollHeight})),this.count++}}},mounted:function(){var t="User: "+JSON.parse(localStorage.getItem("profile")).name;this.showMessage(t)},updated:function(){}}),a=s,o=n("5d22"),c=Object(o["a"])(a,r,i,!1,null,null,null);e["a"]=c.exports},"54ca":function(t,e,n){"use strict";n("3073")},"5c5a":function(t,e,n){"use strict";n.d(e,"e",(function(){return r})),n.d(e,"g",(function(){return i})),n.d(e,"d",(function(){return s})),n.d(e,"f",(function(){return a})),n.d(e,"a",(function(){return c})),n.d(e,"b",(function(){return u})),n.d(e,"c",(function(){return l}));n("4914"),n("95e8"),n("b34d"),n("a5bc"),n("b6b5"),n("0482"),n("31d6"),n("f845"),n("247c");function r(t){var e="",n=[];return n=t.split("/"),n.map((function(t,e){n[e]=t.trim()})),n.length>=6&&(-1!=n[5].indexOf("X")&&(n[5]=n[5].replace("X","")),e=n[5]),e}function i(t){var e=0,n=[];if(n=t.split("/"),n.map((function(t,e){n[e]=t.trim()})),n.length>=6){var r=n[2];-1!=r.indexOf("Q")&&(r=r.replace("Q","")),e=Number(r)}return e}function s(t){var e="",n=[];return n=t.split("*"),n.map((function(t,e){n[e]=t.trim()})),n.length>=6&&(-1!=n[1].indexOf("3OS")&&(n[1]=n[1].replace("3OS","")),e=n[1]),e}function a(t){for(var e="",n=t.split("*"),r=0;r<n.length;r++)n[r]=n[r].trim();return n.length>=6&&(e=n[0].replace(/\+/g,"").replace(/-/g,"")),e}var o=n("31d9");function c(t,e,n,r){return"X3S"==t||"X2S"==t?(o(r).endsWith("T")||(r=n%2==1?1:2,2==r&&(n-=1)),"L".concat(e,"-").concat(n,"-").concat(r)):"L".concat(e,"-").concat(n,"-").concat(r)}function u(t,e){var n=[],r=t.split("-"),i=0;return"AX501"==e?["E"+o(r[0].replace("L","")).padLeft(2,"0").s+o(r[1]).padLeft(2,"0").s]:e.startsWith("NPM")?["POS"+o(r[1]).padLeft(3,"0").s+"$"+r[2]]:(o(r[2]).endsWith("T")?n.push("POS001$"+r[2]):(i=parseInt(r[1]),"2"==r[2]&&(n.push("POS"+o(i+"").padLeft(3,"0").s+"$2"),i+=1),n.push("POS"+o(i+"").padLeft(3,"0").s+"$1")),n)}var l={ERR_LOGINFAILED:"200-登录失败",ERR_NOTNEEDVERIFY:"301-该料站不需要验料",ERR_NOTRACKINFO:"302-请扫描料站条码",ERR_NODIVISIONINFO:"303-请选择料槽号",ERR_NOCMPINFO:"304-请扫描物料",ERR_STATIONNOTINLINE:"305-机台不属于产线",ERR_SCANCOMPONENT:"306-请扫描物料",ERR_TEARDOWNFAILED:"307-卸下出错"}},"95e8":function(t,e,n){"use strict";var r=n("4292"),i=n("0a86").map,s=n("b9d5"),a=s("map");r({target:"Array",proto:!0,forced:!a},{map:function(t){return i(this,t,arguments.length>1?arguments[1]:void 0)}})},b5df:function(t,e,n){},b7bd:function(t,e,n){"use strict";var r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("van-cell",{staticClass:"cellAll",scopedSlots:t._u([{key:"title",fn:function(){return[n("div",{staticClass:"custom-title"},[t._v(t._s(t.title))]),n("van-field",{staticClass:"filed",attrs:{autosize:"",type:t.type,clearable:""},on:{input:t.onInput,focus:t.fieldFocus,blur:t.fieldBlur},scopedSlots:t._u([{key:"right-icon",fn:function(){return[n("van-icon",{attrs:{name:"scan",size:"20",color:"#4284f4"}})]},proxy:!0}]),model:{value:t.value,callback:function(e){t.value=e},expression:"value"}})]},proxy:!0}])})},i=[],s={props:{title:{type:String,require:!1,default:"标题"},value:{require:!1,default:""},type:{type:String,require:!1,default:"textarea"}},methods:{onInput:function(t){this.value=t,this.$emit("update:value",t)},GetVal:function(){return this.value},fieldBlur:function(){window.scroll(0,this.FoucusS),window.onresize=function(){}},fieldFocus:function(){this.FoucusS=document.documentElement.scrollTop-40,window.onresize=function(){return function(){var t=document.body.clientHeight;window.scroll(0,t)}()}}}},a=s,o=(n("54ca"),n("5d22")),c=Object(o["a"])(a,r,i,!1,null,null,null);e["a"]=c.exports},f648:function(t,e,n){"use strict";n.d(e,"c",(function(){return r})),n.d(e,"a",(function(){return i})),n.d(e,"b",(function(){return s}));var r={Pending:10,Pass:20,Failed:30,Reverify_Pass:4,Reverify_Failed:5},i={Locked:1,Closed:2,Completed:3,Initialized:4,MRPLocked:5,Prepared:6,QALocked:7,Ready:8,InProcess:9},s={WatingUse:1,Using:2,Bad:3}},f845:function(t,e,n){"use strict";var r=n("4292"),i=n("016e").f,s=n("2730"),a=n("6ff7"),o=n("11a1"),c=n("8531"),u=n("0fee"),l="".startsWith,p=Math.min,f=c("startsWith"),m=!u&&!f&&!!function(){var t=i(String.prototype,"startsWith");return t&&!t.writable}();r({target:"String",proto:!0,forced:!m&&!f},{startsWith:function(t){var e=String(o(this));a(t);var n=s(p(arguments.length>1?arguments[1]:void 0,e.length)),r=String(t);return l?l.call(e,r,n):e.slice(n,n+r.length)===r}})}}]);