(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-986232bc"],{"1bd9":function(e,t,n){"use strict";n("ee8a")},3073:function(e,t,n){},4176:function(e,t,n){"use strict";n("8234")},"54ca":function(e,t,n){"use strict";n("3073")},"63ea":function(e,t,n){"use strict";n.r(t);var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"PageAll"}},[n("Page",{attrs:{title:e.$t("物料入库"),msgs:"true",showMsg:e.showMsg},on:{clearClick:e.onClear}},[n("div",{staticClass:"op-after-mesg"},[n("ScanInput",{directives:[{name:"show",rawName:"v-show",value:e.isShowScan,expression:"isShowScan"}],attrs:{label:e.$t("扫描条码")},on:{submit:e.m_scanner_OnScannerReaded}}),n("InputCell",{attrs:{title:e.$t("物料条码"),value:e.barcode},on:{"update:value":function(t){e.barcode=t}}}),n("Cell",{attrs:{title:e.$t("物料编码"),value:e.PartNumber}}),n("Cell",{attrs:{title:e.$t("物料数量"),value:e.RemainQty}}),n("Cell",{staticClass:"recommend",attrs:{title:e.$t("推荐库位号"),value:e.lblLocation}}),n("InputCell",{attrs:{title:e.$t("库位号"),value:e.txtLocationBarcode},on:{"update:value":function(t){e.txtLocationBarcode=t}}}),n("van-field",{staticStyle:{"font-size":"12px"},attrs:{"label-width":"80vw",name:"switch",label:e.$t("整箱入库")},scopedSlots:e._u([{key:"input",fn:function(){return[n("van-switch",{attrs:{size:"20"},model:{value:e.chkFullPackage,callback:function(t){e.chkFullPackage=t},expression:"chkFullPackage"}})]},proxy:!0}])})],1),n("van-button",{staticClass:"BtnButton",staticStyle:{"z-index":"1"},attrs:{type:"info",loading:e.btnLoading},on:{click:e.btnPartIn_Click}},[e._v(e._s(e.$t("入库")))])],1)],1)},a=[],s=(n("cc16"),n("7d72"),n("bc4a"),n("c12e"),n("e967"),n("48d1"),n("ec76"),n("6a61"),n("2e91")),c=(n("1f03"),n("ed96")),o=(n("7fd6"),n("f6ab")),i=(n("4910"),n("b3da")),u=n("a593"),l=n("9973"),d=n("b1ea"),h=n("6168"),b=n("9073"),m=n("c9c2"),g=n("b775"),f=n("3753");function p(e,t){return w.apply(this,arguments)}function w(){return w=Object(s["a"])(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(g["a"])(Object(f["a"])("iMES/MLAPI/outPackingPartIn",t),{method:"POST",body:n});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),w.apply(this,arguments)}function x(e,t){return v.apply(this,arguments)}function v(){return v=Object(s["a"])(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(g["a"])(Object(f["a"])("iMES/MLAPI/PartAutoRecommendationStorageOutPacking",t),{method:"POST",body:n});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),v.apply(this,arguments)}function k(e,t){return L.apply(this,arguments)}function L(){return L=Object(s["a"])(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(g["a"])(Object(f["a"])("iMES/MLAPI/SetStatusStorageBoxCommad",t),{method:"POST",body:n});case 2:return r=e.sent,e.abrupt("return",r);case 4:case"end":return e.stop()}}),e)}))),L.apply(this,arguments)}var R=n("b7bd"),$=n("5c5a"),P=n("cf45");u["default"].use(i["a"]),u["default"].use(o["a"]),u["default"].use(c["a"]);var C={components:{Page:l["a"],ScanInput:h["a"],Cell:d["a"],InputCell:R["a"]},computed:{},data:function(){return{chkFullPackage:!1,m_IsOutPacking:!1,m_CurrentPartnumber:"",s_CurrentReelID:"",m_LastStorage:"",m_scanner:"",lblLocation:"",isFixed:"",barcodeLst:[],txtLocationBarcode:"",showMsg:"",PartNumber:"",RemainQty:"",isShowScan:!1,currentWarehouse:null,barcode:"",btnLoading:!1,lastBtnTime:null}},mounted:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.currentWarehouse=JSON.parse(sessionStorage.getItem("currentWarehouse")),e.currentWarehouse&&(n=e,setTimeout((function(){n.showMessage(n.$t("当前仓库:")+n.currentWarehouse.WarehouseName)}),1e3));case 2:case"end":return t.stop()}}),t)})))()},methods:{showMessage:function(e){this.showMsg=e},onClear:function(){},m_scanner_OnScannerReaded:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function n(){var r,a,s,c,o,i,u,l,d;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(e){n.next=2;break}return n.abrupt("return");case 2:if(t.$loading(),r=Object($["e"])(e),-1==e.indexOf("*")){n.next=48;break}if(t.showMessage(t.$t("扫描到条码：")+e),t.barcode=e,!t.chkFullPackage){n.next=15;break}return t.m_IsOutPacking=!0,t.showMessage(t.$t("扫描到外箱物料")+r),t.AddBarcodes(e),n.next=13,t.AutoRecommendationLocation(r);case 13:n.next=46;break;case 15:if(t.m_IsOutPacking=!1,(null==t.m_CurrentPartnumber||t.m_CurrentPartnumber.trim().length<=0)&&(t.m_CurrentPartnumber=r),t.m_CurrentPartnumber==r){n.next=21;break}return t.showMessage(t.$t("当前扫描物料{0} 与已扫描物料{1}不匹配,条码:{2}",[r,t.m_CurrentPartnumber,e])),t.$clrLoading(),n.abrupt("return");case 21:return a=Object($["f"])(e),n.next=24,b["d"]({tclQrCode:e});case 24:if(s=n.sent,s){n.next=28;break}return t.showMessage(t.$t("条码错误")),n.abrupt("return");case 28:if(s.Result){n.next=32;break}return t.showMessage(s.Message),t.$clrLoading(),n.abrupt("return");case 32:if(c=s.Module,null!=c&&0!=c.Id){n.next=37;break}return t.showMessage(a+t.$t("不存在！")),t.$clrLoading(),n.abrupt("return");case 37:if(o=Number(c.RemainQty),t.PartNumber=c.PartNumber,t.RemainQty=c.RemainQty.toString(),!(c.FAC_CellId>0)){n.next=44;break}return t.showMessage(t.$t("该物料{0}已入库，请不要重复操作!",[a])),t.$clrLoading(),n.abrupt("return");case 44:t.AddBarcodes(a),t.AutoRecommendationLocation(r,o);case 46:n.next=78;break;case 48:return n.next=50,m["c"]({ECellCode:e});case 50:if(i=n.sent,!(i&&i.Items.length>0&&e)){n.next=55;break}t.isFixed&&e!=t.lblLocation?t.showMessage(t.$t("库位错误")):(t.showMessage(t.$t("库位:")+e),t.txtLocationBarcode=e),n.next=78;break;case 55:if(e){n.next=57;break}return n.abrupt("return");case 57:return n.next=59,b["j"]({EReelId:e});case 59:if(u=n.sent,!(u&&u.length>0)){n.next=77;break}if(l=u[0],!(l.FAC_CellId>0)){n.next=66;break}return t.showMessage(t.$t("该物料{0}已入库，请不要重复操作!",[e])),t.$clrLoading(),n.abrupt("return");case 66:t.barcode=e,t.AddBarcodes(e),r=l.PartNumber,d=t.$t("ReelID:")+e,d+="\r\n"+t.$t("Qty:")+l.RemainQty,t.showMessage(d),t.PartNumber=l.PartNumber,t.RemainQty=l.RemainQty.toString(),t.AutoRecommendationLocation(r),n.next=78;break;case 77:t.showMessage(e+t.$t("不存在！"));case 78:t.$clrLoading();case 79:case"end":return n.stop()}}),n)})))()},AddBarcodes:function(e){try{if(-1!=this.barcodeLst.indexOf(e)||!e)return void this.showMessage(this.$t("共扫描到{0}盘物料",[this.barcodeLst.length]));this.barcodeLst.push(e),this.showMessage(this.$t("共扫描到{0}盘物料",[this.barcodeLst.length]))}catch(t){this.showMessage(this.$t("处理条码出错")+t)}},AutoRecommendationLocation:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function n(){var r,a,s,c;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(n.prev=0,!t.lblLocation){n.next=3;break}return n.abrupt("return");case 3:return r="",a=0,t.chkFullPackage&&(t.chkFullPackage="1"),n.next=8,b["t"](null,{partnumber:e,storageCellId:t.currentWarehouse.Id,qty:t.barcodeLst.length,lastLoaction:r,chkFullPackage:a});case 8:if(s=n.sent,!(null==s||s.trim().length<=0)){n.next=13;break}t.showMessage(t.$t("物料：")+e+t.$t("没有可用库位")),n.next=18;break;case 13:return t.lblLocation=s,n.next=16,m["c"]({ECellCode:s});case 16:c=n.sent,c.Items[0].FixedPN==e?(t.showMessage(t.$t("推荐库位为固定库位")),t.isFixed=!0):t.isFixed=!1;case 18:n.next=23;break;case 20:n.prev=20,n.t0=n["catch"](0),t.showMessage(t.$t("推荐库位出错：")+n.t0);case 23:case"end":return n.stop()}}),n,null,[[0,20]])})))()},AutoRecommendationLocationOutPackage:function(e){var t=this;try{if(this.lblLocation)return;x({partnumber:e}).then((function(n){null==n||n.trim.length<=0?t.showMessage(t.$t("物料:{0}没有可用库位",[e])):t.lblLocation=n}))}catch(n){this.showMessage(this.$t("推荐库位出错：")+n)}},btnPartIn_Click:function(){if(this.lastBtnTime){var e=(new Date).getTime()-this.lastBtnTime.getTime();if(e<=1e3)return}this.lastBtnTime=new Date,this.$loading(),this.btnLoading=!0,this.m_IsOutPacking?this.OutPackingPartIn():this.ReelPartIn(),this.$clrLoading(),this.btnLoading=!1},ReelPartIn:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var n,r,a,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!(null==e.txtLocationBarcode||e.txtLocationBarcode.trim().length<=0)){t.next=3;break}return e.showMessage(e.$t("请扫描库位条码!")),t.abrupt("return");case 3:if(!(e.barcodeLst.length<=0)){t.next=6;break}return e.showMessage(e.$t("请扫描料盘条码ReelID!")),t.abrupt("return");case 6:return t.prev=6,n=e.txtLocationBarcode,r=n.split("/"),null!=r&&r.length>2&&(n=r[r.length-1]),t.next=12,b["l"](null,{ReelIDList:e.barcodeLst,StorageCode:n});case 12:a=t.sent,a&&a.length>0&&(s=e.$t("Result:Operation success!"),e.showMessage(s),e.ResetAll(),Object(P["d"])()),t.next=20;break;case 16:t.prev=16,t.t0=t["catch"](6),e.showMessage(t.t0),Object(P["c"])();case 20:case"end":return t.stop()}}),t,null,[[6,16]])})))()},OutPackingPartIn:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var n,r,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!(null==e.txtLocationBarcode&&e.txtLocationBarcode.trim().length<=0)){t.next=3;break}return e.showMessage(e.$t("请扫描库位条码!")),t.abrupt("return");case 3:if(!(e.barcodeLst.length<=0)){t.next=6;break}return e.showMessage(e.$t("请扫描料盘条码ReelID!")),t.abrupt("return");case 6:return t.prev=6,n=e.txtLocationBarcode,r=n.split("/"),null!=e.locationArray&&e.locationArray.length>2&&(n=r[r.length-1]),t.next=12,p({barcodeLst:e.barcodeLst.ToArray(),location:location});case 12:a=t.sent,null==a||a.trim().length<=0?(e.showMessage(e.$t("入库完成！数量：{0}盘",[e.barcodeLst.length])),e.ResetAll(),Object(P["d"])()):(e.showMessage(a),Object(P["c"])()),t.next=20;break;case 16:t.prev=16,t.t0=t["catch"](6),e.showMessage(t.t0),Object(P["c"])();case 20:case"end":return t.stop()}}),t,null,[[6,16]])})))()},btnClearLocBarcode_Click:function(){this.txtLocationBarcode=""},btnClearReelBarcode_Click:function(){this.ResetAll()},ResetAll:function(){this.m_LastStorage=this.txtLocationBarcode,this.barcodeLst=[],this.m_CurrentPartnumber="",this.lblLocation="",this.PartNumber="",this.RemainQty=0,this.barcode="",this.txtLocationBarcode=""},btnSilk_Click:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!(null==e.s_CurrentReelID&&e.s_CurrentReelID.trim().length<=0)){t.next=3;break}return e.showMessage(e.$t("请先扫描丝印物料!")),t.abrupt("return");case 3:case"end":return t.stop()}}),t)})))()},StorageStatus:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(t.prev=0,e.txtLocationBarcode.trim()){t.next=4;break}return e.showMessage(e.$t("请扫描库位条码!")),t.abrupt("return");case 4:return e.m_LastStorage=e.txtLocationBarcode.trim(),t.next=7,k({storageCode:e.m_LastStorage,storageStatus:1});case 7:n=t.sent,n?e.lblLocation=n:e.showMessage(e.$t("此柜已满!")),t.next=14;break;case 11:t.prev=11,t.t0=t["catch"](0),e.showMessage(e.$t("此柜已满!")+t.t0);case 14:case"end":return t.stop()}}),t,null,[[0,11]])})))()}}},_=C,M=(n("1bd9"),n("5d22")),S=Object(M["a"])(_,r,a,!1,null,null,null);t["default"]=S.exports},8234:function(e,t,n){},b1ea:function(e,t,n){"use strict";var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("van-cell",{staticClass:"cellAll",scopedSlots:e._u([{key:"title",fn:function(){return[n("div",{staticClass:"custom-title"},[e._v(e._s(e.title))]),n("div",{staticClass:"custom-detail"},[e._v(e._s(e.value))])]},proxy:!0}])})},a=[],s={props:{title:{type:String,require:!1,default:"标题"},value:{require:!1,default:""}},data:function(){return{messages:"",count:0}},methods:{}},c=s,o=(n("4176"),n("5d22")),i=Object(o["a"])(c,r,a,!1,null,null,null);t["a"]=i.exports},b7bd:function(e,t,n){"use strict";var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("van-cell",{staticClass:"cellAll",scopedSlots:e._u([{key:"title",fn:function(){return[n("div",{staticClass:"custom-title"},[e._v(e._s(e.title))]),n("van-field",{staticClass:"filed",attrs:{autosize:"",type:e.type,clearable:""},on:{input:e.onInput,focus:e.fieldFocus,blur:e.fieldBlur},scopedSlots:e._u([{key:"right-icon",fn:function(){return[n("van-icon",{attrs:{name:"scan",size:"20",color:"#4284f4"}})]},proxy:!0}]),model:{value:e.value,callback:function(t){e.value=t},expression:"value"}})]},proxy:!0}])})},a=[],s={props:{title:{type:String,require:!1,default:"标题"},value:{require:!1,default:""},type:{type:String,require:!1,default:"textarea"}},methods:{onInput:function(e){this.value=e,this.$emit("update:value",e)},GetVal:function(){return this.value},fieldBlur:function(){window.scroll(0,this.FoucusS),window.onresize=function(){}},fieldFocus:function(){this.FoucusS=document.documentElement.scrollTop-40,window.onresize=function(){return function(){var e=document.body.clientHeight;window.scroll(0,e)}()}}}},c=s,o=(n("54ca"),n("5d22")),i=Object(o["a"])(c,r,a,!1,null,null,null);t["a"]=i.exports},ee8a:function(e,t,n){}}]);